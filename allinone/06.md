ุฎู ุฎูุจ! ุจุฑู ุณุฑุงุบ **ูุณูุช ถ: ูุชุบุฑูุง ูุญุท (Environment Variables) ุฏุฑ GitLab CI/CD** โ ฺฉ ุงุฒ ูููโุชุฑู ุงุจุฒุงุฑูุง ุจุฑุง ุงููโุณุงุฒุ ูพฺฉุฑุจูุฏ ู ูุฏุฑุช ุฏุงูุงูฺฉ pipeline.

---

## ๐น ูุณูุช ถ: Environment Variables ุฏุฑ GitLab CI/CD

---

### โ Environment Variable ฺูุ

**Environment Variable** (ูุชุบุฑ ูุญุท) ุนู ู ููุฏุงุฑ ฺฉู ุชู ูุญุท ุงุฌุฑุง job ูุฌูุฏ ุฏุงุฑู ู ูโุชููู ุชูุณุท scriptูุง ุงุณุชูุงุฏู ุจุดู. ูุซูุง:

```yaml
script:
  - echo "App running in $APP_ENV"
```

---

### โ ุงููุงุน ูุชุบุฑูุง ุฏุฑ GitLab

| ููุน                         | ุชุนุฑู                                                         | ูุซุงู                            |
| --------------------------- | ------------------------------------------------------------- | ------------------------------- |
| โ User-defined              | ูุชุบุฑูุง ฺฉู ุฎูุฏุช ุฏุฑ ูุงู `.gitlab-ci.yml` ุง UI ุชุนุฑู ูโฺฉู | `APP_ENV=production`            |
| โ Predefined                | ูุชุบุฑูุง ุฏุงุฎู GitLab ฺฉู ุจู ุทูุฑ ุฎูุฏฺฉุงุฑ ุชูุธู ูโุดู            | `CI_COMMIT_BRANCH`, `CI_JOB_ID` |
| โ Secret (Protected/Masked) | ูุชุบุฑูุง ูุฎู ู ุญุณุงุณุ ูุซู ุชูฺฉู ู ูพุณูุฑุฏ                        | `DOCKER_PASSWORD`, `API_KEY`    |

---

### โ ุชุนุฑู ูุชุบุฑ ุฏุฑ ูุงู `.gitlab-ci.yml`

```yaml
variables:
  APP_ENV: production
  DEPLOY_DIR: /var/www/myapp
```

๐ ุงู ูุชุบุฑูุง ุฏุฑ ููู jobูุง ุฏุฑ ุฏุณุชุฑุณ ุฎูุงููุฏ ุจูุฏ.

---

### โ ุชุนุฑู ูุชุบุฑ ุฏุฑ UI (ุงููโุชุฑ):

* ุจุฑู ุจู:

  * **Settings โ CI/CD โ Variables**
  * ุงููุฌุง ูโุชูู:

    * ูุชุบุฑ ุชุนุฑู ฺฉู
    * ูุดุฎุต ฺฉู ููุท ุฏุฑ protected branches ูุงุจู ุงุณุชูุงุฏู ุจุงุดู
    * ููุฏุงุฑ ุฑู Mask ฺฉู (ุฏุฑ ูุงฺฏโูุง ูุดูู ุฏุงุฏู ููโุดู)

ูุซุงู:
`DOCKER_PASSWORD` โ masked, protected

---

### โ ุงุณุชูุงุฏู ุงุฒ ูุชุบุฑ ุฏุฑ script

```yaml
deploy:
  script:
    - echo "Deploying to $DEPLOY_DIR"
```

---

### โ ุงุณุชูุงุฏู ุงุฒ ูุชุบุฑ ุฏุฑ ุดุฑุทโูุง (`rules`)

```yaml
job:
  script: echo "Protected branch"
  rules:
    - if: '$CI_COMMIT_BRANCH == "main"'
```

---

### โ ูุชุบุฑูุง ุฏุงุฎู ูุนุฑูู GitLab

| ูุชุบุฑ                 | ุชูุถุญ                                 |
| --------------------- | ------------------------------------- |
| `CI_COMMIT_BRANCH`    | ูุงู branch ุฌุงุฑ                       |
| `CI_COMMIT_TAG`       | ุงฺฏุฑ tag ุจุงุดุฏุ ููุฏุงุฑุด tag ุงุณุช          |
| `CI_PIPELINE_ID`      | ID ฺฉุชุง pipeline                     |
| `CI_PROJECT_NAME`     | ูุงู ูพุฑูฺู                             |
| `CI_JOB_STAGE`        | ูุงู stage ุฌุงุฑ                        |
| `CI_ENVIRONMENT_NAME` | ูุงู environment ุชุนุฑูโุดุฏู (ุฏุฑ deploy) |

> ๐ ูุณุช ฺฉุงูู ุฏุฑ ุฏุงฺฉูููุช ุฑุณู GitLab:
> [https://docs.gitlab.com/ee/ci/variables/predefined\_variables.html](https://docs.gitlab.com/ee/ci/variables/predefined_variables.html)

---

### โ ูุชุบุฑูุง ุฏุฑ ุณุทุญ Job ูู ูุงุจู ุชุนุฑูโุงูุฏ

```yaml
test:
  variables:
    LOG_LEVEL: debug
  script:
    - echo "Running test with log level: $LOG_LEVEL"
```

> ุงู ูุชุบุฑ ููุท ุชู ููู job ูุนุงู ุฎูุงูุฏ ุจูุฏ.

---

### โ ูฺฉุงุช ููู ูุตุงุญุจูโุง:

| ุณุคุงู ุงุญุชูุงู                   | ูพุงุณุฎ ุฎูุงุตู                                                                 |
| ------------------------------ | -------------------------------------------------------------------------- |
| ูุฑู ูุชุบุฑ ูุงู ู UIุ           | UI ุงููโุชุฑูุ ูุฎุตูุตุง ุจุฑุง ุงุทูุงุนุงุช ุญุณุงุณ                                       |
| ูุฑู Masked ู Protectedุ        | Masked = ูุดูู ุฏุงุฏู ููุดูุ Protected = ููุท ุฏุฑ protected branches ฺฉุงุฑ ูโฺฉูู |
| ฺฉุฌุง ูุชุบุฑ ูุญุท ุงุณุชูุงุฏู ูโุดูุ | ุฏุฑ scriptุ rulesุ conditionูุงุ includeูุง ู ุญุช docker image name           |

---

### โ ูุซุงู ุนูู: ุงุณุชูุงุฏู ุงุฒ secret ุจุฑุง Docker login

```yaml
deploy:
  script:
    - docker login -u $DOCKER_USER -p $DOCKER_PASSWORD
    - docker push my-image
```

> `DOCKER_USER` ู `DOCKER_PASSWORD` ุงุฒ UI ุชุนุฑู ู ูุญุงูุธุช ูโุดู.

---

ูุณูุช ุจุนุฏ ุนู **ูุณูุช ท** ูโุฑู ุณุฑุงุบ **Deployment ุฏุฑ GitLab CI/CD**:
ูุญุทโูุง (Environments)ุ ุนููุงุช Deployุ ู ูุญูู rollout ุจู production/staging.
ุจุฑูุ
